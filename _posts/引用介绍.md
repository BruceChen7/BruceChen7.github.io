title: "引用介绍"
date: 2015-08-15 19:35:41
tags: [Cpp]
---

## 解决的问题
如果我们要解决在函数调用过程中，传递参数的开销(比如大量数据的拷贝开销),我们可以使用传递指针来解决，但是通过传递指针，我们发现有以下的缺点:

* 在每次函数调用的过程中，我们需要这样调用`f(&x)`,有的程序员会觉得比较丑陋，没有`f(x)`那么自然.
* 通过传递指针，我们需要检查指针是否为`nullptr`，这给我们增添了负担。
* 我们需要重载操作符，比如`+`,我们可以很自然的写`x +ｙ`，而不是很丑陋的写`&x +＆ｙ`

所以C++引入了`引用`这个概念。引用是对象的`别名`，通常是通过对象的机器地址实现，对比使用指针，没有产生额外的开销.使用引用的优点:

* 访问引用的时候，就像访问正常的对象一样自然。
* 引用永远指向了已经初始化的对象，这样就不必像指针那样来考虑是否为`nullptr`
* 没有`空引用`这个概念。

## 引用的主要用途
* 引用在C++中，主要作为函数的形参类型和返回值类型和使用。
* 在重载操作符使用的也比较多。用作返回值时，我们希望该操作既能够在等式的左边，又能够在等式的右边。


## 引用的分类
* 左值引用：指向了我们希望改变其值的对象。
* cons对象的 引用： 指向了我们希望其值不会被改变的对象
* 右值引用：指向了一些对象，这些对象在使用后不需要保存。（比如临时对象）


前面两种引用统称为`左值引用`

### 左值引用

`X&`表示X的引用，这是表示左值的引用。所以`X&`也被称为`左值引用`。因为引用必须绑定某个对象，所以必须初始化引用。

	 
	int val = 1;
	int& r1{val};
	int& r2; //errror
	 
引用一旦初始化，就不能够改变其绑定的对象。对引用的改变，将会作用于其绑定的对象。我们不能够对引用取其引用，因为引用是绑定对象的，而引用本身只是一个别名。对引用取引用，意思是对一个别名进行绑定，这是没有意义的。引用不是一个对象，而是一个别名，这点要记住。

左值引用的类型必须与其所绑定的对象相匹配，并且左值引用必须绑定对象，而不是一些字面值(const 引用)和一些通用表达式的值
 
	int &refVal = 10 ; //错误，10不是一个对象，而是一个字面值
	double dval  =  3.14;
	int &refVal5 = dval; //错误，左值引用类型必须与其绑定的对象相匹配
	 


###  const对象的引用
对于对const对象的引用，我们是不能够通过引用来改变值的。对const对象的引用与一般的左值引用的不同点:

* 如果引用的类型和绑定对象的类型不匹配，只要绑定对象的类型能够转成引用类型，就不会报错.
* const对象的引用能够绑定一些字面值和一些一般的表达式值
* 我们可以将const对象的引用来绑定`非const`对象的引用。


	
	int i = 42;
	const int   &r1 = i; // const对象的引用可以绑定非const对象。
	const int &r2 = 42; //可以绑定字面值
	const int &r3  = r1 * 2 //可以绑定一般表达式是值
	double dval = 3.14;
	const int &ri = dval; //没有问题
	 
实际编译器产生的代码:

	const int tmp = dval; //产生了一个临时对象.并且发生了隐式的类型转换。
	const int &ri = dval;
	 
所以上面的代码实际上绑定的是一个临时对象，所谓的`临时对象`,就是编译器产生的用来存储表达式结果没有名字的对象。试想一想我们可以将一个类型不匹配的对象绑定到一个非const的引用的后果：我们可以改变`ri`绑定对象的值，但是这个对象是临时的，不是`dval`,一个传入`ri`程序员认为dval会因此改变，但是实际上ri只会改变临时对象，所以这不是程序员想要的，所以C++禁止了非const引用的这种行为。


### 右值引用
右值引用绑定的一个临时对象，通常使用右值引用，我们认为绑定的对象以后将不会被使用(临时对象)。右值引用只能够绑定右值，不能够绑定左值。通过右值引用，我们可以是移动语义成为可能。

	 
	int i =42;
	int &r = i ; 
	int && rr = i ; // 错误，右值引用不能够绑定左值
	int &r2 = i * 42 ; //错误，左值引用不能够绑定右值
	const int &r3 = i * 42; // 对的,const对象的引用可以绑定表达式的值
	int &&rr2 = i * 42 ; //对的，右值引用可以绑定右值
 


## 要记住的事情

* 引用不是一个对象，而是一个别名。不能够对引用取引用。
* 引用在定义的时候一定要初始化，一旦定义就不能够改变其绑定的对象。
* 一般的引用(非const的左值引用)只能够绑定与其类型相同的对象，不能够是字面值常量和表达式的值
* const对象的引用能够绑定非const 对象，常量，和一般表达式的值
* const对象的引用所能够绑定的对象可以是const对象，也可以不是。const对象的引用限制了我们通过引用来改变绑定对象的值
* 右值引用只能够绑定右值，当然const 引用也可以绑定右值，右值引用的引入是为了实现`move`语义








